name: CI

on:
  pull_request:
    branches: ["main"]

jobs:
  gcc12-basic-asan:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: bazel-contrib/setup-bazel@0.8.2
      with:
        bazelisk-cache: true
        bazelisk-version: 1.19.0
        disk-cache: gcc12-basic-asan
        repository-cache: true
    - run: CC=gcc-12 ASAN_OPTIONS=detect_odr_violation=1 bazel test --config asan ...
    - if: ${{ always() }}
      run: env && cat /home/runner/.bazel/execroot/_main/bazel-out/k8-fastbuild/testlogs/test/reusable/test_allocator/test.log
